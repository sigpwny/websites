---
import Layout from '@/layouts/Base.astro';
import { getCollection } from "astro:content";
import EventCard from '@/components/Event/Card.astro';

const rawEvents = await getCollection('events')

const heroText : Record<string, string> = {
  'uiuctf': 'UIUCTF is a beginner-friendly CTF hosted by SIGPwny. It is open to all students, regardless of experience level.',
  'fallctf': 'Fall CTF is a beginner-friendly CTF hosted by SIGPwny. It is open to all students, regardless of experience level.',
}

// Sort events by date
const groupedEvents = rawEvents.sort((a, b) => {
  return b.data.time_start.valueOf() - a.data.time_start.valueOf()
}).reduce((acc, event) => {
  if (!acc[event.data.series]) {
    acc[event.data.series] = []
  }
  acc[event.data.series].push(event)
  return acc
}, {} as {[series: string]: any[]})
---
<Layout title="Events" description="Index of all SIGPwny events">
  <section id="events" class="pb-8">
    <div class="flex flex-col mx-auto page-width-lg">
      <h1>Events</h1>
      <p>
        We host a variety of events throughout the year, including CTFs, workshops, and socials. Check out our upcoming events below!
      </p>
      <div class="panel">
        {Object.entries(groupedEvents).map(([series, events]) => (
          <div id={series}>
            <p class="font-bold text-2xl m-0">{series}</p>
            {heroText[series] && <p>{heroText[series]}</p>}
            <hr class="border-surface-200" />
            <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5">
            {events.map((event) => (
              <EventCard input={event} />
            ))}
          </div>
          </div>
        ))}
      </div>
    </div>
  </section>