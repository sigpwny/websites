---
import Layout from '@/layouts/Base.astro';
import dayjs from "dayjs";
import Link from '@/components/Link.astro';
import { Picture } from "astro:assets";

import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const publications = await getCollection('publications');
  return publications.map((publication) => ({
    params: { id: publication.id },
    props: { input: publication },
  }));
}

const { input } = Astro.props as { input: CollectionEntry<'publications'> };

const { data: publication, id } = input;
const { title, date: raw_date, credit, publisher, publication_type, primary_link, card_image, tags, links } = publication;
const date = dayjs(raw_date).format('YYYY-MM-DD')
---
<Layout title="Publication">
  <div class="flex w-full items-center justify-center">
      <div class="panel xl:w-2/3">
        <div class="aspect-video overflow-hidden">
        {card_image && card_image.background && (
          <Picture
                src={card_image.background}
                widths={[300, 600, 900]}
                class="overflow-hidden object-cover h-full w-full"
                
                formats={['avif', 'webp']}
                alt={title ?? "Publication card image"}
                />
              )}
    </div>
    <div class="p-2 mb-4">
      {publication_type && (
        <div class="flex flex-row justify-between line-clamp-1 leading-4 m-0 font-mono font-size-small uppercase">
            <div>
                {publication_type} - {publisher} - {credit}
            </div>
            <div>
                {tags && `${tags.join(" - ")} - `} {date}
            </div>
          </div>
        )}
        {title && (
          <p class="line-clamp-2 leading-5 pb-0.5">
            {title}
          </p>
        )}
    </div>
    <div class="flex flex-row gap-4">
      <Link href={primary_link.url} class="btn-primary -mt-1">{primary_link.name}</Link>
      {links?.map(link => (
        <Link href={link.url}>{link.name}</Link>
      ))}
    </div>
  </div>
</div>

</Layout>